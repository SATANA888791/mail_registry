{% extends 'base.html' %}
{% block title %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏{% endblock %}

{% block content %}

{% if filter_type == 'blocked' %}
<div class="alert alert-warning">üîí –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
{% endif %}

<h1>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
<p>
  <a href="{{ url_for('admin.user_create') }}" class="btn btn-success">
    –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  </a>
</p>

<table class="table table-bordered table-hover">
  <thead>
    <tr>
      <th>–õ–æ–≥–∏–Ω</th>
      <th>–ò–º—è</th>
      <th>E-mail</th>
      <th>–†–æ–ª—å</th>
      <th>–û–Ω–ª–∞–π–Ω</th>
      <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
      <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
  </thead>
  <tbody>
    {% for u in users %}
    <tr>
      <td>{{ u.user.username }}</td>
      <td>{{ u.user.display_name or u.user.username }}</td>
      <td>{{ u.user.email }}</td>
      <td>{{ u.user.role.name }}</td>
      <td>
        {% if u.online %}
        üü¢ –û–Ω–ª–∞–π–Ω
        {% else %}
        ‚ö´ –û—Ñ—Ñ–ª–∞–π–Ω
        {% endif %}
      </td>
      <td>{{ u.last_seen }}</td>
      <td>
        <a href="{{ url_for('admin.user_edit', user_id=u.user.id) }}" class="btn btn-sm btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å</a>

        <form method="post" action="{{ url_for('admin.user_delete', user_id=u.user.id) }}" style="display:inline"
          onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å?')">
          <button class="btn btn-sm btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
        </form>

        {% if u.user.id != current_user.id and u.user.role.name != 'Admin' %}
        {% if not u.user.is_blocked %}
        <form method="post" action="{{ url_for('admin.block_user', user_id=u.user.id) }}" style="display:inline">
          <input type="hidden" name="duration" value="permanent">
          <input type="hidden" name="reason" value="–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–∑ –ø–∞–Ω–µ–ª–∏">
          <button class="btn btn-sm btn-warning"
            onclick="return confirm('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å {{ u.user.username }} –Ω–∞–≤—Å–µ–≥–¥–∞?')">
            üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
          </button>
        </form>
        {% else %}
        <form method="post" action="{{ url_for('admin.unblock_user', user_id=u.user.id) }}" style="display:inline">
          <button class="btn btn-sm btn-success" onclick="return confirm('–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å {{ u.user.username }}?')">
            üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
          </button>
        </form>
        {% endif %}
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}